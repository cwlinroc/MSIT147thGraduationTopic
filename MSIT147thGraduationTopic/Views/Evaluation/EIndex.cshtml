@model IEnumerable<MSIT147thGraduationTopic.Models.ViewModels.EvaluationVM>
@{
    ViewData["Title"] = "Index";

}
<!-- 引入 SweetAlert2 的样式文件 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10.16.3/dist/sweetalert2.min.css">

<!-- 引入 SweetAlert2 的 JavaScript 文件 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.16.3/dist/sweetalert2.all.min.js"></script>



<div class="container">
    <div class="row mt-3">
        <div class="col-2"></div>
        <div class="col-8 ">

            @if (Model != null && Model.Count() > 0)
            {
                <div class="d-flex mt-3 ">
                    <div class="ms-auto d-flex flex-column justify-content-end align-items-end ">
                        <h5 id="OrderId">訂單編號:@(Model.FirstOrDefault().OrderId)</h5>
                    </div>
                </div>
                
                <form method="post" action="~/Evaluation/EIndex">
                    <input name="id" value="@(Model.FirstOrDefault().OrderId)" hidden>
                    @for (int i = 0; i < Model.Count(); i++)
                    {
                        var item = Model.ElementAt(i);//ElementAt 將返回索引 n 的專案
                        <div style="border-block-color:#FFDDAA;border-width: 2px">
                            <div class="mt-4 d-flex align-items-center">
                                <div class="d-flex rounded-3 px-1 " style="background-color:#FFDDAA">
                                    <div class="mx-1 mt-2">
                                        <h6 id="MerchandiseName_@(i)">@(item.MerchandiseName)</h6>
                                        <input name="comments[@(i)].MerchandiseId" value="@(item.MerchandiseId)" hidden>
                                    </div>
                                    <div class="mt-2">
                                        <h6 id="SpecName_@(i)"> @(item.SpecName)</h6>
                                        <input name="comments[@(i)].SpecId" hidden>
                                    </div>
                                </div>

                                <div class="d-flex ms-auto float-end">
                                    <div id="score_@(i)" name="Score" class="float-end mx-1 mt-3" itype="starDiv">
                                        <input id="inputscore_@(i)" name="comments[@(i)].Score" hidden>
                                        <img id="stsr@(i)_1" src="/images/空星.png" style="height:40px" />
                                        <img id="stsr@(i)_2" src="/images/空星.png" style="height:40px" />
                                        <img id="stsr@(i)_3" src="/images/空星.png" style="height:40px" />
                                        <img id="stsr@(i)_4" src="/images/空星.png" style="height:40px" />
                                        <img id="stsr@(i)_5" src="/images/空星.png" style="height:40px" />
                                    </div>
                                </div>
                            </div>
                            <div class="form-floating mx-2 mt-2 mb-4">
                                <textarea id="commentText" name="comments[@(i)].Comment" class="form-control" placeholder="Leave a comment here" style="height: 100px"></textarea>
                                <label for="floatingTextarea2">@(item.Comment)</label>
                            </div>
                        </div>
                    }
                    <div>
                        <button id="send" type="submit" class="btn btn-primary float-end mt-2 mx-1">送出</button>
                        @*<button id="edit" type="submit" class="btn btn-primary float-end mt-2 mx-1">編輯</button>*@
                    </div>
                </form>

            }
            else
            {
                <text>
                    <script>
                        Swal.fire('此筆訂單目前查無資料');
                    </script>
                </text>
            }
        </div>

        <div class="col-2"></div>
    </div>
</div>
@section Scripts{

    <script>
        const starImages = [
            "/images/空星.png",
            "/images/一星.png",
            "/images/二星.png",
            "/images/三星.png",
            "/images/四星.png",
            "/images/五星.png",
        ];

        let stars = $('div[itype="starDiv"] > img');
        let score = 0;
        //console.log(stars)

        stars.hover(
            function () {
                lightingStar($(this));
            },
            function () {
                //console.log(this.parent().children());
                $(this).parent().children().attr('src', starImages[0]);
            }
        );

        stars.click(function () {
            //若要改評分
            if (score > 0) {
                $(this).parent().children().attr('src', starImages[0]);
                $(this).parent().children().bind('mouseenter').bind('mouseleave');
            }
            //else{} 直接執行再次評分
            lightingStar($(this));
            $(this).parent().children().unbind('mouseenter').unbind('mouseleave');
            //$(this).siblings("img").unbind('mouseenter').unbind('mouseleave');

            score = $(this).attr('id').split('_')[1];
            //console.log($(this).parent().find('input').attr('id'));
            $(this).parent().find('input').val(score);  //將score值放入input
            //console.log($(this).parent().find('input').val());
        });


        let lightingStar = function (obj) {
            let idArray = obj.attr('id').split('_');  //.split 字串分割
            //console.log(idArray);
            let index = idArray[1]; //第n顆星星
            //console.log(index);
            for (let i = 0; i <= index; i++) {
                //stars.eq(i).attr('src', starImages[i + 1]);
                $("#" + idArray[0] + "_" + i).attr('src', starImages[i]);
            }
        }



    </script>
}


